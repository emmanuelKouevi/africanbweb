{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { required } from 'vuelidate/lib/validators';\nimport axios from 'axios';\nimport $ from 'jquery';\nimport { API_CREER_MODE_ABONNEMENT, API_OBTENIR_REFERENCE_PAR_PAR_FAMILLE, HEADERS } from '../globalConfig/globalConstConfig';\nexport default {\n  name: \"CreerModeAbonnement\",\n  data() {\n    return {\n      errorMsg: null,\n      successMsg: null,\n      overlay: false,\n      menuDebutAbonnement: false,\n      menuFinAbonnement: false,\n      date: new Date(Date.now() - new Date().getTimezoneOffset() * 60000).toISOString().substr(0, 10),\n      dateDebutAbonnementPrevelement: null,\n      dateFinAbonnementPrevelement: null,\n      dateDebutAbonnementPeriodique: null,\n      dateFinAbonnementPeriodique: null,\n      referenceAbonnementList: [],\n      referencePeriodiciteList: [],\n      typeAbonnement: null,\n      referenceAbonnement: {\n        referenceFamilleDesignation: \"referenceFamilleAbonnement\"\n      },\n      referencePeriodiciteAbonnement: {\n        referenceFamilleDesignation: \"referenceFamillePeriodiciteAbonnement\"\n      },\n      objectToSendReferenceAbonnement: {\n        datas: []\n      },\n      objectToSendReferencePeriodicite: {\n        datas: []\n      },\n      modeAbonnementPeriodiqueModel: {\n        designation: null,\n        dateDebutAbonnement: null,\n        dateFinAbonnement: null,\n        redevance: null,\n        redevancePublicite: null,\n        typeModeAbonnementDesignation: null,\n        periodiciteAbonnementDesignation: null,\n        compagnieTransportRaisonSociale: \"Kouevi CT\"\n      },\n      modeAbonnementPrelevementModel: {\n        designation: null,\n        dateDebutAbonnement: null,\n        dateFinAbonnement: null,\n        taux: null,\n        periodiciteAbonnementDesignation: null,\n        compagnieTransportRaisonSociale: \"Kouevi CT\"\n      },\n      abonnementObject: {\n        datas: []\n      }\n    };\n  },\n  validations: {\n    modeAbonnementPeriodiqueModel: {\n      designation: {\n        required\n      },\n      dateDebutAbonnement: {\n        required\n      },\n      dateFinAbonnement: {\n        required\n      },\n      redevance: {\n        required\n      },\n      redevancePublicite: {\n        required\n      },\n      typeModeAbonnementDesignation: {\n        required\n      },\n      periodiciteAbonnementDesignation: {\n        required\n      }\n    },\n    modeAbonnementPrelevementModel: {\n      designation: {\n        required\n      },\n      taux: {\n        required\n      },\n      dateDebutAbonnement: {\n        required\n      },\n      dateFinAbonnement: {\n        required\n      },\n      periodiciteAbonnementDesignation: {\n        required\n      }\n    }\n  },\n  methods: {\n    // SOUMISSION DU FORMULAIRE\n    submitForm() {\n      this.creerAbonnementCompagnie();\n    },\n    // CREER UN MODE ABONNEMENT DE TYPE PERIODIQUE\n    async creerModeAbonnementPeriodique() {\n      if (this.typeAbonnement == 'AbonnementPeriodique') {\n        this.overlay = true;\n        this.modeAbonnementPeriodiqueModel.dateDebutAbonnement = new Date(this.dateDebutAbonnementPeriodique).toLocaleDateString('en-GB');\n        this.modeAbonnementPeriodiqueModel.dateFinAbonnement = new Date(this.dateFinAbonnementPeriodique).toLocaleDateString('en-GB');\n        this.abonnementObject.datas = [];\n        this.modeAbonnementPeriodiqueModel.typeModeAbonnementDesignation = this.typeAbonnement;\n        this.abonnementObject.datas.push(this.modeAbonnementPeriodiqueModel);\n        await axios.post(API_CREER_MODE_ABONNEMENT, this.abonnementObject, {\n          headers: HEADERS(this.$store.state.userAuthentified.token)\n        }).then(response => {\n          if (response.status == 200) {\n            if (response.data.status.code == 800) {\n              this.successMsg = response.data.status.message;\n              $(\".alert-success\").fadeIn();\n              setTimeout(function () {\n                $(\".alert-success\").fadeOut();\n              }, 4000);\n              this.abonnementObject.datas = [];\n            } else {\n              this.errorMsg = response.data.status.message;\n              $(\".alert-error\").fadeIn();\n              setTimeout(function () {\n                $(\".alert-error\").fadeOut();\n              }, 3000);\n              this.abonnementObject.datas = [];\n            }\n          } else if (response.status == 204) {\n            this.warningMsg = \"Erreur , lors de la création de l'offre de voyage\";\n            $(\".alert-warning\").fadeIn();\n            setTimeout(function () {\n              $(\".alert-warning\").fadeOut();\n            }, 3000);\n            this.abonnementObject.datas = [];\n          } else {\n            this.errorMsg = \"Erreur , opération de création impossible\";\n            $(\".alert-error\").fadeIn();\n            setTimeout(function () {\n              $(\".alert-error\").fadeOut();\n            }, 3000);\n            this.abonnementObject.datas = [];\n          }\n        }).catch(e => {\n          this.errorMsg = e;\n          $(\".alert-error\").fadeIn();\n          setTimeout(function () {\n            $(\".alert-error\").fadeOut();\n          }, 4000);\n          this.abonnementObject.datas = [];\n        }).finally(() => {\n          this.overlay = false;\n        });\n      }\n    },\n    // CREER UN MODE ABONNEMENT DE TYPE PRELEVEMENT\n    async creerModeAbonnementPrelevement() {\n      if (this.typeAbonnement == 'AbonnementPrelevement') {\n        this.overlay = true;\n        this.modeAbonnementPrelevementModel.dateDebutAbonnement = new Date(this.dateDebutAbonnementPrevelement).toLocaleDateString('en-GB');\n        this.modeAbonnementPrelevementModel.dateFinAbonnement = new Date(this.dateFinAbonnementPrevelement).toLocaleDateString('en-GB');\n        this.abonnementObject.datas = [];\n        this.modeAbonnementPrelevementModel.typeModeAbonnementDesignation = this.typeAbonnement;\n        this.abonnementObject.datas.push(this.modeAbonnementPrelevementModel);\n        await axios.post(API_CREER_MODE_ABONNEMENT, this.abonnementObject, {\n          headers: HEADERS(this.$store.state.userAuthentified.token)\n        }).then(response => {\n          if (response.status == 200) {\n            if (response.data.status.code == 800) {\n              this.successMsg = response.data.status.message;\n              $(\".alert-success\").fadeIn();\n              setTimeout(function () {\n                $(\".alert-success\").fadeOut();\n              }, 4000);\n              this.abonnementObject.datas = [];\n            } else {\n              this.errorMsg = response.data.status.message;\n              $(\".alert-error\").fadeIn();\n              setTimeout(function () {\n                $(\".alert-error\").fadeOut();\n              }, 3000);\n              this.abonnementObject.datas = [];\n            }\n          } else if (response.status == 204) {\n            this.warningMsg = \"Erreur , lors de la création de l'offre de voyage\";\n            $(\".alert-warning\").fadeIn();\n            setTimeout(function () {\n              $(\".alert-warning\").fadeOut();\n            }, 3000);\n            this.abonnementObject.datas = [];\n          } else {\n            this.errorMsg = \"Erreur , opération de création impossible\";\n            $(\".alert-error\").fadeIn();\n            setTimeout(function () {\n              $(\".alert-error\").fadeOut();\n            }, 3000);\n            this.abonnementObject.datas = [];\n          }\n        }).catch(e => {\n          this.errorMsg = e;\n          $(\".alert-error\").fadeIn();\n          setTimeout(function () {\n            $(\".alert-error\").fadeOut();\n          }, 4000);\n          this.abonnementObject.datas = [];\n        }).finally(() => {\n          this.overlay = false;\n        });\n      }\n    },\n    // CREER UN MODE D'ABONNEMENT\n    async creerAbonnementCompagnie() {\n      this.creerModeAbonnementPeriodique();\n      this.creerModeAbonnementPrelevement();\n    },\n    //OBTENIR REFERENCE DESIGNATION ABONNEMENT\n    async obtenirReferenceAbonnementList() {\n      this.objectToSendReferenceAbonnement.datas.push(this.referenceAbonnement);\n      await axios.post(API_OBTENIR_REFERENCE_PAR_PAR_FAMILLE, this.objectToSendReferenceAbonnement, {\n        headers: HEADERS(this.$store.state.userAuthentified.token)\n      }).then(response => {\n        this.referenceAbonnementList = response.data.items;\n      }).catch(e => {\n        this.errorMsg = e;\n        $(\".alert-error\").fadeIn();\n        setTimeout(function () {\n          $(\".alert-error\").fadeOut();\n        }, 4000);\n      });\n    },\n    //OBTENIR REFERENCE DESIGNATION PERIODICITÉ\n    async obtenirReferencePeriodicteAbonnementList() {\n      this.objectToSendReferencePeriodicite.datas.push(this.referencePeriodiciteAbonnement);\n      await axios.post(API_OBTENIR_REFERENCE_PAR_PAR_FAMILLE, this.objectToSendReferencePeriodicite, {\n        headers: HEADERS(this.$store.state.userAuthentified.token)\n      }).then(response => {\n        this.referencePeriodiciteList = response.data.items;\n      }).catch(e => {\n        this.errorMsg = e;\n        $(\".alert-error\").fadeIn();\n        setTimeout(function () {\n          $(\".alert-error\").fadeOut();\n        }, 4000);\n      });\n    },\n    // FORMAT DE LA DATE\n    formatDate(date) {\n      if (!date) return null;\n      const [year, month, day] = date.split('-');\n      return `${day}/${month}/${year}`;\n    },\n    //VERIFIE SI CEST UN NOMBRE POSITIF\n    isNumber(item) {\n      return item > 0;\n    }\n  },\n  computed: {\n    computedDateFormatted() {\n      return this.formatDate(this.modeAbonnementPrelevementModel.dateDebutAbonnement);\n    },\n    // GESTION DES CONTRAINTES DE CHAMPS D'ENTREES POUR LA CREATION D'UN ABONNEMENT\n\n    designationAbonnementErrors() {\n      const errors = [];\n      if (!this.$v.modeAbonnementPeriodiqueModel.designation.$dirty) return errors;\n      !this.$v.modeAbonnementPeriodiqueModel.designation.required && errors.push('La désignation est obligatoire.');\n      return errors;\n    },\n    redevanceAbonnementErrors() {\n      const errors = [];\n      if (!this.$v.modeAbonnementPeriodiqueModel.redevance.$dirty) return errors;\n      !this.isNumber(this.modeAbonnementPeriodiqueModel.redevance) && errors.push('Saisissez un prix correct.');\n      !this.$v.modeAbonnementPeriodiqueModel.redevance.required && errors.push('Le prix est obligatoire.');\n      return errors;\n    },\n    typeAbonnementErrors() {\n      const errors = [];\n      if (!this.$v.modeAbonnementPeriodiqueModel.typeModeAbonnementDesignation.$dirty) return errors;\n      !this.$v.modeAbonnementPeriodiqueModel.typeModeAbonnementDesignation.required && errors.push('La selection du type du sac est obligatoire.');\n      return errors;\n    },\n    periodiciteAbonnementErrors() {\n      const errors = [];\n      if (!this.$v.modeAbonnementPeriodiqueModel.periodiciteAbonnementDesignation.$dirty) return errors;\n      !this.$v.modeAbonnementPeriodiqueModel.periodiciteAbonnementDesignation.required && errors.push('Veuillez renseigner ce champs.');\n      return errors;\n    },\n    redevancePubAbonnementErrors() {\n      const errors = [];\n      !this.isNumber(this.modeAbonnementPeriodiqueModel.redevancePublicite) && errors.push('Saisissez un nombre correct.');\n      if (!this.$v.modeAbonnementPeriodiqueModel.redevancePublicite.$dirty) return errors;\n      !this.$v.modeAbonnementPeriodiqueModel.redevancePublicite.required && errors.push('Veuillez renseigner ce champs.');\n      return errors;\n    },\n    dateDebutAbonnementErrors() {\n      const errors = [];\n      if (!this.$v.modeAbonnementPeriodiqueModel.dateDebutAbonnement.$dirty) return errors;\n      !this.$v.modeAbonnementPeriodiqueModel.dateDebutAbonnement.required && errors.push('Veuillez renseigner ce champs.');\n      return errors;\n    },\n    dateFinAbonnementErrors() {\n      const errors = [];\n      if (!this.$v.modeAbonnementPeriodiqueModel.dateDebutAbonnement.$dirty) return errors;\n      !this.$v.modeAbonnementPeriodiqueModel.dateDebutAbonnement.required && errors.push('Veuillez renseigner ce champs.');\n      return errors;\n    }\n  },\n  mounted() {\n    this.obtenirReferenceAbonnementList();\n    this.obtenirReferencePeriodicteAbonnementList();\n  }\n};","map":{"version":3,"mappings":";AA4JA;AACA;AACA;AACA;AAEA;EACAA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MAEAC;MACAC;MAEAC;MACAC;MAEAC;MACAC;MAEAC;MAEAC;QACAC;MACA;MACAC;QACAD;MACA;MAEAE;QACAC;MACA;MACAC;QACAD;MACA;MAEAE;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MAEAC;QACAR;QACAC;QACAC;QACAO;QACAH;QACAC;MACA;MAEAG;QACAb;MACA;IACA;EACA;EAEAc;IACAZ;MAEAC;QACAY;MACA;MACAX;QACAW;MACA;MACAV;QACAU;MACA;MACAT;QACAS;MACA;MACAR;QACAQ;MACA;MACAP;QACAO;MACA;MACAN;QACAM;MACA;IAEA;IAEAJ;MACAR;QACAY;MACA;MACAH;QACAG;MACA;MACAX;QACAW;MACA;MACAV;QACAU;MACA;MACAN;QACAM;MACA;IACA;EACA;EAEAC;IACA;IACAC;MACA;IACA;IAGA;IACA;MACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;UAAAC;QAAA;UACA;YACA;cACA;cACAC;cACAC;gBACAD;cACA;cACA;YACA;cACA;cACAA;cACAC;gBACAD;cACA;cACA;YACA;UAEA,OACA;YACA;YACAA;YACAC;cACAD;YACA;YACA;UACA,OACA;YACA;YACAA;YACAC;cACAD;YACA;YACA;UACA;QACA;UACA;UACAA;UACAC;YACAD;UACA;UACA;QACA;UACA;QACA;MACA;IACA;IAGA;IACA;MACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;UAAAD;QAAA;UACA;YACA;cACA;cACAC;cACAC;gBACAD;cACA;cACA;YACA;cACA;cACAA;cACAC;gBACAD;cACA;cACA;YACA;UAEA,OACA;YACA;YACAA;YACAC;cACAD;YACA;YACA;UACA,OACA;YACA;YACAA;YACAC;cACAD;YACA;YACA;UACA;QACA;UACA;UACAA;UACAC;YACAD;UACA;UACA;QACA;UACA;QACA;MACA;IACA;IAGA;IACA;MACA;MACA;IACA;IAEA;IACA;MACA;MACA;QAAAD;MAAA;QACA;MACA;QACA;QACAC;QACAC;UACAD;QACA;MACA;IACA;IAEA;IACA;MACA;MACA;QAAAD;MAAA;QACA;MACA;QACA;QACAC;QACAC;UACAD;QACA;MACA;IACA;IAEA;IACAE;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;IACA;EACA;EAEAC;IAEAC;MACA;IACA;IAEA;;IAEAC;MACA;MACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MACA;IACA;EAGA;EAEAC;IACA;IACA;EACA;AAEA","names":["name","data","errorMsg","successMsg","overlay","menuDebutAbonnement","menuFinAbonnement","date","dateDebutAbonnementPrevelement","dateFinAbonnementPrevelement","dateDebutAbonnementPeriodique","dateFinAbonnementPeriodique","referenceAbonnementList","referencePeriodiciteList","typeAbonnement","referenceAbonnement","referenceFamilleDesignation","referencePeriodiciteAbonnement","objectToSendReferenceAbonnement","datas","objectToSendReferencePeriodicite","modeAbonnementPeriodiqueModel","designation","dateDebutAbonnement","dateFinAbonnement","redevance","redevancePublicite","typeModeAbonnementDesignation","periodiciteAbonnementDesignation","compagnieTransportRaisonSociale","modeAbonnementPrelevementModel","taux","abonnementObject","validations","required","methods","submitForm","headers","$","setTimeout","formatDate","isNumber","computed","computedDateFormatted","designationAbonnementErrors","redevanceAbonnementErrors","typeAbonnementErrors","periodiciteAbonnementErrors","redevancePubAbonnementErrors","dateDebutAbonnementErrors","dateFinAbonnementErrors","mounted"],"sourceRoot":"src/components/administration_compagnie_transport","sources":["CreerModeAbonnement.vue"],"sourcesContent":["<template>\n    <v-app>\n        <v-form @submit.prevent=\"submitForm\">\n            <v-container fluid>\n                <v-card width=\"1200\" elevation=\"3\">\n                    <v-card-title><h6 class=\"font-weight-bold\">MODE D'ABONNEMENTS</h6></v-card-title>\n                    <v-card-subtitle>Définissez vos modes d'abonnements</v-card-subtitle>\n\n                    <v-card-text>\n                        <div class=\"form-group col-md-6\">\n                            <label for=\"typeAbonnement\">Type d'abonnement:</label>\n                            <v-select :error-messages=\"typeAbonnementErrors\" \n                                id=\"typeAbonnement\" data-cy=\"typeAbonnement\" class=\"my_input\"\n                                v-model=\"typeAbonnement\" :items=\"referenceAbonnementList\"\n                                dense outlined  item-text=\"designation\" color=\"primary\"\n                                item-value=\"designation\" placeholder=\"Sélectionnez\">\n                            </v-select>\n                        </div>\n                        <v-divider></v-divider>\n                        <div v-if=\"typeAbonnement == 'AbonnementPeriodique'\">\n                            <div class=\"form-row\">\n                                <div class=\"form-group col-md-6\">\n                                    <label for=\"designationAbonnement\">Designation de l'abonnement:</label>\n                                    <v-text-field :error-messages=\"designationAbonnementErrors\" id=\"designationAbonnement\"\n                                        dense outlined placeholder=\"Designation de l'abonnement\" data-cy=\"designationAbonnement\"\n                                        v-model.trim=\"$v.modeAbonnementPeriodiqueModel.designation.$model\">\n                                    </v-text-field>\n                                </div>\n\n                                <div class=\"form-group col-md-3\">\n                                    <label for=\"redevance\">Redevance</label>\n                                    <v-text-field :error-messages=\"redevanceAbonnementErrors\" id=\"redevance\"\n                                        dense outlined color=\"primary\" placeholder=\"redevance\" \n                                        suffix=\"FCFA\" v-model.trim=\"$v.modeAbonnementPeriodiqueModel.redevance.$model\">\n                                    </v-text-field>\n                                </div>\n\n                                <div class=\"form-group col-md-3\">\n                                    <label for=\"redevancePublicite\">Redevance publicité</label>\n                                    <v-text-field :error-messages=\"redevancePubAbonnementErrors\" id=\"redevancePublicite\"\n                                        dense outlined color=\"primary\" placeholder=\"redevance publicité\" data-cy=\"redevancePublicite\"\n                                        v-model.trim=\"$v.modeAbonnementPeriodiqueModel.redevancePublicite.$model\" suffix=\"FCFA\" >\n                                    </v-text-field>\n                                </div>\n                            </div>\n\n                            <div class=\"form-row\">\n                                <div class=\"form-group col-md-6\">\n                                    <label for=\"periodiciteAbonnement\">Periodicité:</label>\n                                    <v-select :items=\"referencePeriodiciteList\" item-value=\"designation\" id=\"periodiciteAbonnement\"\n                                        item-text=\"designation\" :error-messages=\"periodiciteAbonnementErrors\" data-cy=\"periodiciteAbonnement\"\n                                        dense outlined color=\"primary\" placeholder=\"périodicité Abonnement\" \n                                        v-model.trim=\"$v.modeAbonnementPeriodiqueModel.periodiciteAbonnementDesignation.$model\">\n                                    </v-select>\n                                </div>\n\n                                <div class=\"form-group col-md-3\">\n                                    <label for=\"dateDebutAbonnement\">Debut d'Abonnement:</label>\n                                    <v-menu ref=\"menuDebutAbonnement\" v-model=\"menuDebutAbonnement\" :close-on-content-click=\"false\" transition=\"scale-transition\" offset-y max-width=\"290px\" min-width=\"auto\">\n                                        <template v-slot:activator=\"{ on, attrs }\">\n                                            <v-text-field id=\"dateDebutAbonnement\" :error-messages=\"dateDebutAbonnementErrors\" dense outlined \n                                                v-model=\"dateDebutAbonnementPeriodique\" placeholder=\"Debut de l'abonnement\" append-icon=\"mdi-clock-time-four-outline\"\n                                                readonly  v-bind=\"attrs\" v-on=\"on\" data-cy=\"dateDebutAbonnement\">\n                                            </v-text-field>\n                                        </template>\n                                        <v-date-picker @input=\"menuDebutAbonnement = false\" v-model=\"dateDebutAbonnementPeriodique\" no-title></v-date-picker>\n                                    </v-menu>\n                                </div>\n\n                                <div class=\"form-group col-md-3\">\n                                    <label for=\"dateFinAbonnement\">Date de fin d'Abonnement</label>\n                                    <v-menu ref=\"menuFinAbonnement\" v-model=\"menuFinAbonnement\" :close-on-content-click=\"false\" transition=\"scale-transition\" offset-y max-width=\"290px\" min-width=\"auto\">\n                                        <template v-slot:activator=\"{ on, attrs }\">\n                                            <v-text-field id=\"dateDebutAbonnement\" :error-messages=\"dateFinAbonnementErrors\" dense outlined v-model=\"dateFinAbonnementPeriodique\" placeholder=\"Fin de l'abonnement\" append-icon=\"mdi-clock-time-four-outline\"\n                                                readonly  v-bind=\"attrs\" v-on=\"on\" data-cy=\"dateFinAbonnement\">\n                                            </v-text-field>\n                                        </template>\n                                        <v-date-picker @input=\"menuFinAbonnement = false\" v-model=\"dateFinAbonnementPeriodique\" no-title></v-date-picker>\n                                    </v-menu>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div v-if=\"typeAbonnement == 'AbonnementPrelevement'\">\n                            <div class=\"form-row\">\n                                <div class=\"form-group col-md-6\">\n                                    <label for=\"designationAbonnement\">Designation de l'abonnement:</label>\n                                    <v-text-field :error-messages=\"designationAbonnementErrors\" id=\"designationAbonnement\"\n                                        dense outlined placeholder=\"Designation de l'abonnement\" data-cy=\"designationAbonnement\"\n                                        v-model.trim=\"$v.modeAbonnementPrelevementModel.designation.$model\">\n                                    </v-text-field>\n                                </div>\n\n                                <div class=\"form-group col-md-6\">\n                                    <label for=\"periodicite\">Periodicité</label>\n                                    <v-select :items=\"referencePeriodiciteList\" item-value=\"designation\" id=\"periodicite\"\n                                        item-text=\"designation\" :error-messages=\"periodiciteAbonnementErrors\" \n                                        dense outlined color=\"teal\" placeholder=\"périodicité Abonnement\" data-cy=\"periodicite\"\n                                        v-model.trim=\"$v.modeAbonnementPrelevementModel.periodiciteAbonnementDesignation.$model\">\n                                    </v-select>\n                                </div>\n                            </div>\n\n                            <div class=\"form-row\">\n                                <div class=\"form-group col-md-4\">\n                                    <label for=\"taux\">Taux:</label>\n                                    <v-text-field :error-messages=\"designationAbonnementErrors\" id=\"taux\"\n                                        dense outlined placeholder=\"Taux\" data-cy=\"taux\"\n                                        v-model.trim=\"$v.modeAbonnementPrelevementModel.taux.$model\">\n                                    </v-text-field>\n                                </div>\n\n                                <div class=\"form-group col-md-4\">\n                                    <label for=\"debutAbonnement\">Debut Abonnement</label>\n                                    <v-menu ref=\"menuDebutAbonnement\" v-model=\"menuDebutAbonnement\" :close-on-content-click=\"false\" transition=\"scale-transition\" offset-y max-width=\"290px\" min-width=\"auto\">\n                                        <template v-slot:activator=\"{ on, attrs }\">\n                                            <v-text-field id=\"debutAbonnement\" :error-messages=\"dateDebutAbonnementErrors\" \n                                                dense outlined v-model=\"dateDebutAbonnementPrevelement\"  \n                                                placeholder=\"Debut de l'abonnement\" append-icon=\"mdi-calendar\"\n                                                readonly  v-bind=\"attrs\" v-on=\"on\" data-cy=\"debutAbonnement\">\n                                            </v-text-field>\n                                        </template>\n                                        <v-date-picker @input=\"menuDebutAbonnement = false\" v-model=\"dateDebutAbonnementPrevelement\" no-title></v-date-picker>\n                                    </v-menu>\n                                </div>\n\n                                <div class=\"form-group col-md-4\">\n                                    <label for=\"finAbonnement\">Fin Abonnement</label>\n                                    <v-menu ref=\"menuFinAbonnement\" v-model=\"menuFinAbonnement\" :close-on-content-click=\"false\" transition=\"scale-transition\" offset-y max-width=\"290px\" min-width=\"auto\">\n                                        <template v-slot:activator=\"{ on, attrs }\">\n                                            <v-text-field id=\"finAbonnement\" :error-messages=\"dateFinAbonnementErrors\"  dense outlined v-model=\"dateFinAbonnementPrevelement\" \n                                                placeholder=\"Fin de l'abonnement\" append-icon=\"mdi-calendar\"\n                                                readonly  v-bind=\"attrs\" v-on=\"on\" data-cy=\"finAbonnement\">\n                                            </v-text-field>\n                                        </template>\n                                        <v-date-picker @input=\"menuFinAbonnement = false\" v-model=\"dateFinAbonnementPrevelement\" no-title></v-date-picker>\n                                    </v-menu>\n                                </div>\n                            </div>\n                        </div>\n                    </v-card-text>\n\n                    <v-card-actions>\n                        <v-btn small outlined>REINITIALISER</v-btn>\n                        <v-btn small type=\"submit\" outlined color=\"primary\">VALIDER</v-btn>\n                    </v-card-actions>\n                </v-card>\n            </v-container>\n        </v-form>\n        <v-alert class=\"myalert alert-error\" type=\"error\" width=\"350px\" dismissible>{{ errorMsg }}</v-alert>\n        <v-alert class=\"myalert alert-success\" type=\"success\" width=\"350px\" dismissible>{{ successMsg }}</v-alert>\n        <v-overlay :value=\"overlay\"><v-progress-circular indeterminate size=\"64\"></v-progress-circular></v-overlay>\n    </v-app>\n</template>\n\n<script>\nimport { required } from 'vuelidate/lib/validators';\nimport axios from 'axios'\nimport $ from 'jquery'\nimport { API_CREER_MODE_ABONNEMENT, API_OBTENIR_REFERENCE_PAR_PAR_FAMILLE , HEADERS } from '../globalConfig/globalConstConfig'\n\nexport default {\n    name:\"CreerModeAbonnement\",\n    data(){\n        return{\n            errorMsg : null,\n            successMsg : null,\n            overlay : false,\n            menuDebutAbonnement:false,\n            menuFinAbonnement:false,\n            date: (new Date(Date.now() - (new Date()).getTimezoneOffset() * 60000)).toISOString().substr(0, 10),\n\n            dateDebutAbonnementPrevelement : null,\n            dateFinAbonnementPrevelement : null,\n\n            dateDebutAbonnementPeriodique : null,\n            dateFinAbonnementPeriodique : null,\n\n            referenceAbonnementList:[],\n            referencePeriodiciteList:[],\n\n            typeAbonnement : null,\n\n            referenceAbonnement:{\n                referenceFamilleDesignation: \"referenceFamilleAbonnement\"\n            },\n            referencePeriodiciteAbonnement:{\n                referenceFamilleDesignation:\"referenceFamillePeriodiciteAbonnement\"\n            },\n\n            objectToSendReferenceAbonnement:{\n                datas:[],\n            },\n            objectToSendReferencePeriodicite:{\n                datas:[],\n            },\n\n            modeAbonnementPeriodiqueModel:{\n                designation : null,\n                dateDebutAbonnement:null,\n                dateFinAbonnement: null,\n                redevance : null, \n                redevancePublicite : null,\n                typeModeAbonnementDesignation: null,\n                periodiciteAbonnementDesignation: null,\n                compagnieTransportRaisonSociale: \"Kouevi CT\",\n            },\n\n            modeAbonnementPrelevementModel:{\n                designation : null,\n                dateDebutAbonnement:null,\n                dateFinAbonnement: null,\n                taux:null,\n                periodiciteAbonnementDesignation: null,\n                compagnieTransportRaisonSociale: \"Kouevi CT\",\n            },\n\n            abonnementObject:{\n                datas:[],\n            }\n        }\n    },\n\n    validations:{\n        modeAbonnementPeriodiqueModel:{\n            \n            designation:{\n                required\n            },\n            dateDebutAbonnement:{\n                required\n            },\n            dateFinAbonnement:{\n                required\n            },\n            redevance:{\n                required\n            },\n            redevancePublicite:{\n                required\n            },\n            typeModeAbonnementDesignation:{\n                required\n            },\n            periodiciteAbonnementDesignation:{\n                required\n            },\n\n        },\n\n        modeAbonnementPrelevementModel:{\n            designation:{\n                required\n            },\n            taux:{\n                required\n            },\n            dateDebutAbonnement:{\n                required\n            },\n            dateFinAbonnement:{\n                required\n            },\n            periodiciteAbonnementDesignation:{\n                required\n            },\n        }\n    },\n    \n    methods:{\n        // SOUMISSION DU FORMULAIRE\n        submitForm(){\n            this.creerAbonnementCompagnie();\n        },\n\n\n        // CREER UN MODE ABONNEMENT DE TYPE PERIODIQUE\n        async creerModeAbonnementPeriodique(){\n            if (this.typeAbonnement == 'AbonnementPeriodique') {\n                this.overlay = true;\n                this.modeAbonnementPeriodiqueModel.dateDebutAbonnement = new Date(this.dateDebutAbonnementPeriodique).toLocaleDateString('en-GB');\n                this.modeAbonnementPeriodiqueModel.dateFinAbonnement = new Date(this.dateFinAbonnementPeriodique).toLocaleDateString('en-GB');\n                this.abonnementObject.datas = [];\n                this.modeAbonnementPeriodiqueModel.typeModeAbonnementDesignation = this.typeAbonnement;\n                this.abonnementObject.datas.push(this.modeAbonnementPeriodiqueModel);\n                await axios.post(API_CREER_MODE_ABONNEMENT, this.abonnementObject , { headers : HEADERS(this.$store.state.userAuthentified.token) }).then((response) => {\n                    if (response.status == 200) {\n                        if (response.data.status.code == 800) {\n                            this.successMsg = response.data.status.message\n                            $(\".alert-success\").fadeIn();\n                            setTimeout(function(){\n                                $(\".alert-success\").fadeOut(); \n                            }, 4000)\n                            this.abonnementObject.datas = [] ;\n                        }else{\n                            this.errorMsg = response.data.status.message\n                            $(\".alert-error\").fadeIn();\n                            setTimeout(function(){\n                                $(\".alert-error\").fadeOut(); \n                            }, 3000)\n                            this.abonnementObject.datas = [] ;\n                        }  \n                    \n                    }\n                    else if (response.status == 204) {\n                        this.warningMsg = \"Erreur , lors de la création de l'offre de voyage\";\n                        $(\".alert-warning\").fadeIn();\n                        setTimeout(function(){\n                            $(\".alert-warning\").fadeOut(); \n                        }, 3000)\n                        this.abonnementObject.datas = [] ;\n                    }\n                    else{\n                        this.errorMsg = \"Erreur , opération de création impossible\";\n                        $(\".alert-error\").fadeIn();\n                        setTimeout(function(){\n                            $(\".alert-error\").fadeOut(); \n                        }, 3000)\n                        this.abonnementObject.datas = [] ;\n                    }\n                }).catch((e) => {\n                    this.errorMsg = e ;\n                    $(\".alert-error\").fadeIn();\n                    setTimeout(function(){\n                        $(\".alert-error\").fadeOut(); \n                    }, 4000)\n                    this.abonnementObject.datas = [] ;\n                }).finally(() => {\n                    this.overlay = false;\n                })\n            }\n        },\n\n\n        // CREER UN MODE ABONNEMENT DE TYPE PRELEVEMENT\n        async creerModeAbonnementPrelevement(){\n            if (this.typeAbonnement == 'AbonnementPrelevement'){\n                this.overlay = true;\n                this.modeAbonnementPrelevementModel.dateDebutAbonnement = new Date(this.dateDebutAbonnementPrevelement).toLocaleDateString('en-GB');\n                this.modeAbonnementPrelevementModel.dateFinAbonnement = new Date(this.dateFinAbonnementPrevelement).toLocaleDateString('en-GB');\n                this.abonnementObject.datas = [];\n                this.modeAbonnementPrelevementModel.typeModeAbonnementDesignation = this.typeAbonnement;\n                this.abonnementObject.datas.push(this.modeAbonnementPrelevementModel); \n                await axios.post(API_CREER_MODE_ABONNEMENT, this.abonnementObject , { headers : HEADERS(this.$store.state.userAuthentified.token) }).then((response) => {\n                    if (response.status == 200) {\n                        if (response.data.status.code == 800) {\n                            this.successMsg = response.data.status.message\n                            $(\".alert-success\").fadeIn();\n                            setTimeout(function(){\n                                $(\".alert-success\").fadeOut(); \n                            }, 4000)\n                            this.abonnementObject.datas = [] ;\n                        }else{\n                            this.errorMsg = response.data.status.message\n                            $(\".alert-error\").fadeIn();\n                            setTimeout(function(){\n                                $(\".alert-error\").fadeOut(); \n                            }, 3000)\n                            this.abonnementObject.datas = [] ;\n                        }  \n                    \n                    }\n                    else if (response.status == 204) {\n                        this.warningMsg = \"Erreur , lors de la création de l'offre de voyage\";\n                        $(\".alert-warning\").fadeIn();\n                        setTimeout(function(){\n                            $(\".alert-warning\").fadeOut(); \n                        }, 3000)\n                        this.abonnementObject.datas = [] ;\n                    }\n                    else{\n                        this.errorMsg = \"Erreur , opération de création impossible\";\n                        $(\".alert-error\").fadeIn();\n                        setTimeout(function(){\n                            $(\".alert-error\").fadeOut(); \n                        }, 3000)\n                        this.abonnementObject.datas = [] ;\n                    }\n                }).catch((e) => {\n                    this.errorMsg = e ;\n                    $(\".alert-error\").fadeIn();\n                    setTimeout(function(){\n                        $(\".alert-error\").fadeOut(); \n                    }, 4000)\n                    this.abonnementObject.datas = [] ;\n                }).finally(() => {\n                    this.overlay = false;\n                })\n            }\n        },\n\n\n        // CREER UN MODE D'ABONNEMENT\n        async creerAbonnementCompagnie(){\n            this.creerModeAbonnementPeriodique();\n            this.creerModeAbonnementPrelevement();\n        },\n\n        //OBTENIR REFERENCE DESIGNATION ABONNEMENT\n        async obtenirReferenceAbonnementList(){\n            this.objectToSendReferenceAbonnement.datas.push(this.referenceAbonnement)\n            await axios.post(API_OBTENIR_REFERENCE_PAR_PAR_FAMILLE, this.objectToSendReferenceAbonnement , { headers : HEADERS(this.$store.state.userAuthentified.token) }).then((response) => {\n                this.referenceAbonnementList = response.data.items;\n            }).catch((e) => {\n                this.errorMsg = e ;\n                $(\".alert-error\").fadeIn();\n                setTimeout(function(){\n                    $(\".alert-error\").fadeOut(); \n                }, 4000)\n            })\n        },\n\n        //OBTENIR REFERENCE DESIGNATION PERIODICITÉ\n        async obtenirReferencePeriodicteAbonnementList(){\n            this.objectToSendReferencePeriodicite.datas.push(this.referencePeriodiciteAbonnement)\n            await axios.post(API_OBTENIR_REFERENCE_PAR_PAR_FAMILLE, this.objectToSendReferencePeriodicite , { headers : HEADERS(this.$store.state.userAuthentified.token) }).then((response) => {\n                this.referencePeriodiciteList = response.data.items;\n            }).catch((e) => {\n                this.errorMsg = e ;\n                $(\".alert-error\").fadeIn();\n                setTimeout(function(){\n                    $(\".alert-error\").fadeOut(); \n                }, 4000)\n            })\n        },\n    \n        // FORMAT DE LA DATE\n        formatDate (date) {\n            if (!date) return null\n            const [year, month, day] = date.split('-')\n            return `${day}/${month}/${year}`\n        },\n\n        //VERIFIE SI CEST UN NOMBRE POSITIF\n        isNumber(item){\n          return  item  > 0\n        },\n    },\n\n    computed:{\n\n        computedDateFormatted () {\n            return this.formatDate(this.modeAbonnementPrelevementModel.dateDebutAbonnement)\n        },\n\n        // GESTION DES CONTRAINTES DE CHAMPS D'ENTREES POUR LA CREATION D'UN ABONNEMENT\n\n        designationAbonnementErrors(){\n           const errors = [];\n            if (!this.$v.modeAbonnementPeriodiqueModel.designation.$dirty) return errors\n            !this.$v.modeAbonnementPeriodiqueModel.designation.required && errors.push('La désignation est obligatoire.')\n            return errors \n        },\n\n        redevanceAbonnementErrors(){\n           const errors = [];\n            if (!this.$v.modeAbonnementPeriodiqueModel.redevance.$dirty) return errors\n            !this.isNumber(this.modeAbonnementPeriodiqueModel.redevance) && errors.push('Saisissez un prix correct.')\n            !this.$v.modeAbonnementPeriodiqueModel.redevance.required && errors.push('Le prix est obligatoire.')\n            return errors \n        },\n\n        typeAbonnementErrors(){\n           const errors = [];\n            if (!this.$v.modeAbonnementPeriodiqueModel.typeModeAbonnementDesignation.$dirty) return errors\n            !this.$v.modeAbonnementPeriodiqueModel.typeModeAbonnementDesignation.required && errors.push('La selection du type du sac est obligatoire.')\n            return errors \n        },\n\n        periodiciteAbonnementErrors(){\n            const errors = [];\n            if (!this.$v.modeAbonnementPeriodiqueModel.periodiciteAbonnementDesignation.$dirty) return errors\n            !this.$v.modeAbonnementPeriodiqueModel.periodiciteAbonnementDesignation.required && errors.push('Veuillez renseigner ce champs.')\n            return errors \n        },\n\n        redevancePubAbonnementErrors(){\n            const errors = [];\n            !this.isNumber(this.modeAbonnementPeriodiqueModel.redevancePublicite) && errors.push('Saisissez un nombre correct.')\n            if (!this.$v.modeAbonnementPeriodiqueModel.redevancePublicite.$dirty) return errors\n            !this.$v.modeAbonnementPeriodiqueModel.redevancePublicite.required && errors.push('Veuillez renseigner ce champs.')\n            return errors \n        },\n\n        dateDebutAbonnementErrors(){\n            const errors = [];\n            if (!this.$v.modeAbonnementPeriodiqueModel.dateDebutAbonnement.$dirty) return errors\n            !this.$v.modeAbonnementPeriodiqueModel.dateDebutAbonnement.required && errors.push('Veuillez renseigner ce champs.')\n            return errors \n        },\n\n        dateFinAbonnementErrors(){\n            const errors = [];\n            if (!this.$v.modeAbonnementPeriodiqueModel.dateDebutAbonnement.$dirty) return errors\n            !this.$v.modeAbonnementPeriodiqueModel.dateDebutAbonnement.required && errors.push('Veuillez renseigner ce champs.')\n            return errors \n        },\n\n\n    },\n\n    mounted(){\n        this.obtenirReferenceAbonnementList();\n        this.obtenirReferencePeriodicteAbonnementList();\n    }\n\n}\n</script>\n\n<style scoped>\n\n    .myalert{\n        display: none;\n        z-index: 1900;\n    }\n\n    .alert-success{\n        position: fixed;\n        top: 25px;\n        right:2%;\n        width: 25%;\n    }\n\n    .alert-error{\n        position: fixed;\n        top: 25px;\n        right:2%;\n        width: 25%;\n    }\n\n    .alert-warning{\n        position: fixed;\n        top: 25px;\n        right:2%;\n        width: 25%;\n    } \n\n</style>"]},"metadata":{},"sourceType":"module"}